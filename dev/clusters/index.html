<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cluster Execution · Experimenter.jl</title><meta name="title" content="Cluster Execution · Experimenter.jl"/><meta property="og:title" content="Cluster Execution · Experimenter.jl"/><meta property="twitter:title" content="Cluster Execution · Experimenter.jl"/><meta name="description" content="Documentation for Experimenter.jl."/><meta property="og:description" content="Documentation for Experimenter.jl."/><meta property="twitter:description" content="Documentation for Experimenter.jl."/><meta property="og:url" content="https://JamieMair.github.io/Experimenter.jl/clusters/"/><meta property="twitter:url" content="https://JamieMair.github.io/Experimenter.jl/clusters/"/><link rel="canonical" href="https://JamieMair.github.io/Experimenter.jl/clusters/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Experimenter.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../execution/">Running your Experiments</a></li><li><a class="tocitem" href="../distributed/">Distributed Execution</a></li><li class="is-active"><a class="tocitem" href>Cluster Execution</a><ul class="internal"><li><a class="tocitem" href="#MPI"><span>MPI</span></a></li><li><a class="tocitem" href="#Experiment-file"><span>Experiment file</span></a></li><li><a class="tocitem" href="#SLURM"><span>SLURM</span></a></li></ul></li><li><a class="tocitem" href="../store/">Data Store</a></li><li><a class="tocitem" href="../snapshots/">Custom Snapshots</a></li><li><a class="tocitem" href="../api/">Public API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Cluster Execution</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cluster Execution</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JamieMair/Experimenter.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JamieMair/Experimenter.jl/blob/main/docs/src/clusters.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Cluster-Execution"><a class="docs-heading-anchor" href="#Cluster-Execution">Cluster Execution</a><a id="Cluster-Execution-1"></a><a class="docs-heading-anchor-permalink" href="#Cluster-Execution" title="Permalink"></a></h1><p>This package is most useful for running grid search trials on a cluster environment (i.e. a HPC), or a single node with many CPUs. </p><p>There are two main ways you can distribute your experiment over many processes - <code>DistributedMode</code> or <code>MPIMode</code>. </p><p>For those using a distributed cluster, we recommend that you launch your jobs using the <a href="https://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a> functionality, instead of the legacy <a href="https://slurm.schedmd.com/overview.html">SLURM</a> support (see the <a href="#slurm">SLURM</a> section below for details).</p><h2 id="MPI"><a class="docs-heading-anchor" href="#MPI">MPI</a><a id="MPI-1"></a><a class="docs-heading-anchor-permalink" href="#MPI" title="Permalink"></a></h2><h3 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h3><p>Most HPC environments have access to their own MPI implementation. These MPI implementations often take advantage of proprietary interconnect (networking) between the nodes that allow for low-latency and high-throughput communication. If you would like to find your local HPC&#39;s implementation, you may be able to look through the catalogue via a bash terminal, using the <a href="https://modules.sourceforge.net/">Environment Modules</a> package available on most HPC systems:</p><pre><code class="language-bash hljs">module avail</code></pre><p>or, for a more directed search:</p><pre><code class="language-bash hljs">module spider mpi</code></pre><p>You may have multiple versions. If you are unsure as to which version to use, check the documentation for the HPC, contact your local System Administrator or simply use what is available. Using OpenMPI is often a reliable choice. </p><p>You can load which version of MPI you would like by adding</p><pre><code class="language-bash hljs">module load mpi/latest</code></pre><p>to your job script (remember to change <code>mpi/latest</code> to the package available on your system).</p><p>Make you have loaded the MPI version you wish to use by running the <code>module load ...</code> command in the same terminal before opening Julia in the terminal by using</p><pre><code class="language-bash hljs">julia --project</code></pre><p>Run this command in the same directory as your project.</p><p>Now, you have to add the <code>MPI</code> package to your local environment using</p><pre><code class="language-julia hljs">import Pkg; Pkg.add(&quot;MPI&quot;)</code></pre><p>Now you should be able to load <code>MPIPreferences</code> and tell MPI about using your system binary:</p><pre><code class="language-julia hljs">using MPI.MPIPreferences

MPIPreferences.use_system_binary()
exit()</code></pre><p>This should create a new <code>LocalPreferences.toml</code> file. I would recommend adding this file to your <code>.gitignore</code> list and not committing it to your GitHub repository.</p><h3 id="Job-Scripts"><a class="docs-heading-anchor" href="#Job-Scripts">Job Scripts</a><a id="Job-Scripts-1"></a><a class="docs-heading-anchor-permalink" href="#Job-Scripts" title="Permalink"></a></h3><p>When you are running on a cluster, write your job script so that you load MPI and precompile Julia before launching your job. An example job script could look like the following:</p><pre><code class="language-bash hljs">#!/bin/bash

#SBATCH --ntasks=8
#SBATCH --cpus-per-task=4
#SBATCH --mem-per-cpu=2048
#SBATCH --time=00:30:00
#SBATCH -o mpi_job_%j.out


module load mpi/latest
module load julia/1.10.2

# Precompile Julia first to avoid race conditions
julia --project --threads=4 -e &#39;import Pkg; Pkg.instantiate()&#39;
julia --project --threads=4 -e &#39;import Pkg; Pkg.precompile()&#39;

mpirun -n 8 julia --project --threads=4 my_experiment.jl</code></pre><p>Use the above as a template and change the specifics to suit your specific workload and HPC.</p><div class="admonition is-info" id="Info-2f4ea4b5b05963db"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-2f4ea4b5b05963db" title="Permalink"></a></header><div class="admonition-body"><p>Make sure that you launch your jobs with at least 2 processes (tasks), as one task is dedicated towards coordinating the execution of trials and saving the results.</p></div></div><h2 id="Experiment-file"><a class="docs-heading-anchor" href="#Experiment-file">Experiment file</a><a id="Experiment-file-1"></a><a class="docs-heading-anchor-permalink" href="#Experiment-file" title="Permalink"></a></h2><p>As usual, you should write a script to define your experiment and run the configuration. Below is an example, where it is assumed there is another file called <code>run.jl</code> which contains a function <code>run_trial</code> which takes a configuration dictionary and a trial <code>UUID</code>.</p><pre><code class="language-julia hljs">using Experimenter

config = Dict{Symbol,Any}(
    :N =&gt; IterableVariable([Int(1e6), Int(2e6), Int(3e6)]),
    :seed =&gt; IterableVariable([1234, 4321, 3467, 134234, 121]),
    :sigma =&gt; 0.0001)
experiment = Experiment(
    name=&quot;Test Experiment&quot;,
    include_file=&quot;run.jl&quot;,
    function_name=&quot;run_trial&quot;,
    configuration=deepcopy(config)
)

db = open_db(&quot;experiments.db&quot;)

# Init the cluster
Experimenter.Cluster.init()

@execute experiment db MPIMode(1)</code></pre><p>Note that we are calling <code>MPIMode(1)</code> which says that we want a communication batch size of <code>1</code>. If your jobs are small, and you want each worker to process a batch at a time, you can set this to a higher number.</p><h2 id="SLURM"><a class="docs-heading-anchor" href="#SLURM">SLURM</a><a id="SLURM-1"></a><a class="docs-heading-anchor-permalink" href="#SLURM" title="Permalink"></a></h2><div class="admonition is-warning" id="Warning-da03a2450a1d4409"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-da03a2450a1d4409" title="Permalink"></a></header><div class="admonition-body"><p>It is recommended that you use the above MPI mode to run jobs on a cluster, instead of relying on <code>ClusterManagers.jl</code>, as it is much slower to run jobs.</p></div></div><p>Normally when running on SLURM, one creates a bash script to tell the scheduler about the resource requirements for a job. The following is an example:</p><pre><code class="language-bash hljs">#!/bin/bash

#SBATCH --nodes=2
#SBATCH --ntasks=2
#SBATCH --cpus-per-task=2
#SBATCH --mem-per-cpu=1024
#SBATCH --time=00:30:00
#SBATCH -o hpc/output/test_job_%j.out</code></pre><p>The function [<code>Experimenter.Cluster.create_slurm_template</code>] provides an easy way to create one of these bash scripts with everything you need to run.</p><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>Let us take the following end-to-end example. Say that we have an experiment script at <code>my_experiment.jl</code> (contents below), which now initialises the cluster:</p><pre><code class="language-julia hljs">using Experimenter

config = Dict{Symbol,Any}(
    :N =&gt; IterableVariable([Int(1e6), Int(2e6), Int(3e6)]),
    :seed =&gt; IterableVariable([1234, 4321, 3467, 134234, 121]),
    :sigma =&gt; 0.0001)
experiment = Experiment(
    name=&quot;Test Experiment&quot;,
    include_file=&quot;run.jl&quot;,
    function_name=&quot;run_trial&quot;,
    configuration=deepcopy(config)
)

db = open_db(&quot;experiments.db&quot;)

# Init the cluster
Experimenter.Cluster.init()

@execute experiment db DistributedMode</code></pre><p>Additionally, we have the file <code>run.jl</code> containing:</p><pre><code class="language-julia hljs">using Random
using Distributed
function run_trial(config::Dict{Symbol,Any}, trial_id)
    results = Dict{Symbol, Any}()
    sigma = config[:sigma]
    N = config[:N]
    seed = config[:seed]
    rng = Random.Xoshiro(seed)
    # Perform some calculation
    results[:distance] = sum(rand(rng) * sigma for _ in 1:N)
    results[:num_threads] = Threads.nthreads()
    results[:hostname] = gethostname()
    results[:pid] = Distributed.myid()
    # Must return a Dict{Symbol, Any}, with the data we want to save
    return results
end</code></pre><p>We can now create a bash script to run our experiment. We create a template by running the following in the terminal (or adjust or the REPL)</p><pre><code class="language-bash hljs">julia --project -e &#39;using Experimenter; Experimenter.Cluster.create_slurm_template(&quot;myrun.sh&quot;)&#39;</code></pre><p>We then modify the create <code>myrun.sh</code> file to the following:</p><pre><code class="language-bash hljs">#!/bin/bash

#SBATCH --ntasks=4
#SBATCH --cpus-per-task=2
#SBATCH --mem-per-cpu=1024
#SBATCH --time=00:30:00
#SBATCH -o hpc/logs/job_%j.out

julia --project --threads=1 my_experiment.jl

# Optional: Remove the files created by ClusterManagers.jl
rm -fr julia-*.out
</code></pre><p>Once written, we execute this on the cluster via</p><pre><code class="language-bash hljs">sbatch myrun.sh</code></pre><p>We can then open a Julia REPL (once the job has finished) to see the results:</p><pre><code class="language-julia hljs">using Experimenter
db = open_db(&quot;experiments.db&quot;)
trials = get_trials_by_name(db, &quot;Test Experiment&quot;)

for (i, t) in enumerate(trials)
    hostname = t.results[:hostname]
    id = t.results[:pid]
    println(&quot;Trial $i ran on $hostname on worker $id&quot;)
end</code></pre><p>Support for running on SLURM is based on <a href="https://gist.github.com/JamieMair/0b1ffbd4ee424c173e6b42fe756e877a">this gist</a> available on GitHub. This gist also provides information on how to adjust the SLURM script to allow for one GPU to be allocated to each worker.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../distributed/">« Distributed Execution</a><a class="docs-footer-nextpage" href="../store/">Data Store »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Sunday 25 January 2026 12:37">Sunday 25 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
